<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Design rationale &mdash; Tutorial: Templates for reproducible research projects</title>
    
    <link rel="stylesheet" href="_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Tutorial: Templates for reproducible research projects" href="index.html" />
    <link rel="next" title="Introduction to Waf" href="waf.html" />
    <link rel="prev" title="Introduction" href="introduction.html" />

<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-24904064-4', 'hmgaudecker.github.io');
  ga('send', 'pageview');

</script>

  </head>
  <body>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="waf.html" title="Introduction to Waf"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="Introduction"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Tutorial: Templates for reproducible research projects</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="design-rationale">
<span id="rationale"></span><h1>Design rationale<a class="headerlink" href="#design-rationale" title="Permalink to this headline">¶</a></h1>
<p>The design of the project templates is guided by the following main thoughts:</p>
<blockquote>
<div><ol class="arabic simple">
<li><strong>Separation of logical chunks</strong> A minimal requirement for a project to scale.</li>
<li><strong>Only execute required tasks, automatically</strong> Again required for scalability. It means that the machine needs to know what is meant by a &#8220;required task&#8221;.</li>
<li><strong>Re-use of code and data instead of copying and pasting</strong> Else you will forget the copy &amp; paste step at some point down the road. At best, this leads to errors; at worst, to misinterpreting the results.</li>
<li><strong>Be as language-agnostic as possible</strong> Make it easy to use the best tool for a particular task and to mix tools in a project.</li>
<li><strong>Separation of inputs and outputs</strong> Required to find your way around in a complex project.</li>
</ol>
</div></blockquote>
<p>I will not touch upon the last point until the <a class="reference internal" href="organisation.html#organisation"><em>Organisation</em></a> section below. The remainder of this page introduces an example and a general concept of how to think about the first four points.</p>
<div class="section" id="running-example">
<h2>Running example<a class="headerlink" href="#running-example" title="Permalink to this headline">¶</a></h2>
<p>To fix ideas, let&#8217;s look at the example of Schelling&#8217;s (1969, <a class="reference internal" href="zreferences.html#schelling69" id="id1">[Sch69]</a>) segregation model, as outlined <a class="reference external" href="http://quant-econ.net/schelling.html#schelling-s-segregation-model">here</a> in Stachurski&#8217;s and Sargent&#8217;s online course <a class="reference internal" href="zreferences.html#stachurskisargent13" id="id2">[SS13]</a>. Please look at their <a class="reference external" href="http://quant-econ.net/schelling.html#schelling-s-segregation-model">description</a> of the Schelling model. Say we are thinking of two variants for the moment:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Replicate the <a class="reference external" href="http://quant-econ.net/schelling.html#results">figures</a> from Stachurski&#8217;s and Sargent&#8217;s course.</li>
<li>Check what happens when agents are restricted to two random moves per period; after that they have to stop regardless whether they are happy or not.</li>
</ol>
</div></blockquote>
<p>For each of these variants (called <strong>models</strong> in the project template and the remainder of this document), you need to perform various steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Draw a simulated sample with initial locations (this is taken to be the same across models, partly for demonstration purposes, partly because it assures that the initial distribution is the same across both models)</li>
<li>Run the actual simulation</li>
<li>Visualise the results</li>
<li>Pull everything together in a paper.</li>
</ol>
</div></blockquote>
<p>It is very useful to explictly distinguish between steps 2. and 3. because computation time in 2. becomes an issue: If you just want to change the layout of a table or the color of a line in a graph, you do not want to wait for days. Not even for 3 minutes or 30 seconds as in this example.</p>
</div>
<div class="section" id="how-to-organise-the-workflow">
<span id="workflow"></span><h2>How to organise the workflow?<a class="headerlink" href="#how-to-organise-the-workflow" title="Permalink to this headline">¶</a></h2>
<p>A naïve way to ensure reproducibility is to have a <em>master-script</em> (do-file, m-file, ...) that runs each file one after the other. One way to implement that for the above setup would be to have code for each step of the analysis and a loop over both models within each step:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/steps_only_full.png"><img alt="_images/steps_only_full.png" src="_images/steps_only_full.png" style="width: 25em;" /></a>
</div>
<p>You will still need to manually keep track of whether you need to run a particular step after making changes, though. Or you run everything at once, all the time. Alternatively, you may have code that runs one step after the other for each model:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/model_steps_full.png"><img alt="_images/model_steps_full.png" src="_images/model_steps_full.png" style="width: 25em;" /></a>
</div>
<p>The equivalent comment applies here: Either keep track of which model needs to be run after making changes manually, or run everything at once.</p>
<p>Ideally though, you want to be even more fine-grained than this and only run individual elements. This is particularly true when your entire computations take some time. In this case, running all steps every time via the <em>master-script</em> simply is not an option. All my research projects ended up running for a long time, no matter how simple they were... The figure shows you that even in this simple example, there are now quite a few parts to remember:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/model_steps_select.png"><img alt="_images/model_steps_select.png" src="_images/model_steps_select.png" style="width: 25em;" /></a>
</div>
<p>This figure assumes that your data management is being done for all models at once, which is usually a good choice for me. Even with only two models, we need to remember 6 ways to start different programs and how the different tasks depend on each other. <strong>This does not scale to serious projects!</strong></p>
</div>
<div class="section" id="directed-acyclic-graphs-dags">
<span id="dag-s"></span><h2>Directed Acyclic Graphs (DAGs)<a class="headerlink" href="#directed-acyclic-graphs-dags" title="Permalink to this headline">¶</a></h2>
<p>The way to specify dependencies between data, code and tasks to perform for a computer is a directed acyclic graph. A graph is simply a set of nodes (files, in our case) and edges that connect pairs of nodes (tasks to perform). Directed means that the order of how we connect a pair of nodes matters, we thus add arrows to all edges. Acyclic means that there are no directed cycles: When you traverse a graph in the direction of the arrows, there may not be a way to end up at the same node again.</p>
<p>This is the dependency graph for the modified Schelling example from Stachurski and Sargent, as implemented in the Python branch of the project template:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/schelling_dependencies.png"><img alt="_images/schelling_dependencies.png" src="_images/schelling_dependencies.png" style="width: 50em;" /></a>
</div>
<p>The arrows have different colors in order to distinguish the steps of the analysis, from left to right:</p>
<blockquote>
<div><ul class="simple">
<li>Blue for data management (=drawing a simulated sample, in this case)</li>
<li>Orange for the main simulation</li>
<li>Teal for the visualisation of results</li>
<li>Red for compiling the pdf of the paper</li>
</ul>
</div></blockquote>
<p>Bluish nodes are pure source files &#8211; they do not depend on any other file and hence no arrow points towards any of them. In contrast, brownish nodes are targets, they are generated by the code. Some may serve as intermediate targets only &#8211; e.g. there is not much you would want to do with the binary file of the simulated sample (<em>initial_locations.csv</em>) except for processing it further.</p>
<p>In a first run, all targets have to be generated, of course. In later runs, a target only needs to be re-generated if one of its direct <strong>dependencies</strong> changes. E.g. when we make changes to <em>baseline.json</em>, we will need to build <em>schelling_baseline.pickle</em> and  <em>schelling_baseline.png</em> anew. Depending on whether <em>schelling_baseline.png</em> actually changes, we need to re-compile the pdf as well. We will dissect this example in more detail in the next section. The only important thing at this point is to understand the general idea.</p>
<p>Of course this is overkill for a textbook example &#8211; we could easily keep the code closer together than this. But such a strategy does not scale to serious papers with many different specifications. As a case in point, consider the DAG for an early version of <a class="reference internal" href="zreferences.html#gaudecker14" id="id3">[vGng]</a>:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/pfefficiency.jpg"><img alt="_images/pfefficiency.jpg" src="_images/pfefficiency.jpg" style="width: 35em;" /></a>
</div>
<p>Do you want to keep those dependencies in your head? Or would it be useful to specify them once and for all in order to have more time for thinking about research? The next section shows you how to do that.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Design rationale</a><ul>
<li><a class="reference internal" href="#running-example">Running example</a></li>
<li><a class="reference internal" href="#how-to-organise-the-workflow">How to organise the workflow?</a></li>
<li><a class="reference internal" href="#directed-acyclic-graphs-dags">Directed Acyclic Graphs (DAGs)</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="introduction.html"
                        title="previous chapter">Introduction</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="waf.html"
                        title="next chapter">Introduction to Waf</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="waf.html" title="Introduction to Waf"
             >next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="Introduction"
             >previous</a> |</li>
        <li><a href="index.html">Tutorial: Templates for reproducible research projects</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2013-, Hans-Martin von Gaudecker.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
<div class="footer">This page uses <a href="http://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

  </body>
</html>