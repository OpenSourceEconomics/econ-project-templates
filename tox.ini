
[tox]
envlist = pytest, pre-commit, sphinx
skipsdist = True
skip_missing_interpreters = True

[testenv]
basepython = python


[testenv:pytest]
deps =
    kaleido
    pytest-pythonpath
    cookiecutter
    click==7.0
setenv =
    CONDA_DLL_SEARCH_MODIFICATION_ENABLE = 1
conda_channels =
    conda-forge
    plotly
    r
conda_deps =
    conda-build
    ipykernel
    ipython
    jupyterlab
    nbsphinx
    pandas
    pip
    plotly
    pre_commit
    pytask-latex>=0.0.12
    pytask-r>=0.0.9
    pytask-stata>=0.0.6
    pytask>=0.0.14
    pytest
    pytest-cookies
    pytest-cov
    python-graphviz
    r-aer
    r-aod
    r-base
    r-car
    r-essentials
    r-lmtest
    r-rjson
    r-sandwich
    sphinx
    sphinx_rtd_theme
    sphinx-autobuild
    sphinxcontrib-bibtex
    tox-conda
commands = pytest {posargs}


[testenv:pre-commit]
passenv = USERPROFILE SSH_AUTH_SOCK
deps =
    pre-commit
    Pygments
commands =
    pre-commit install -f --install-hooks
    pre-commit run --all-files

[testenv:sphinx]
changedir = docs/src
conda_channels =
    conda-forge
conda_deps =
    ipython
    nbsphinx
    sphinx
    sphinx_rtd_theme
    sphinx-autobuild
    sphinxcontrib-bibtex
commands =
    # Add W flag to builds so that warnings become errors.
    sphinx-build -nT -b html -d {envtmpdir}/doctrees . {envtmpdir}/html


[pytest]
filterwarnings =
    ignore: Using or importing the ABCs from 'collections'
markers =
    wip: Tests that are work-in-progress.
    slow: Tests that take a long time to run and are skipped in continuous integration.
norecursedirs =
    docs
    .tox
