(directory_structure)=

# Directory Structure

## The big picture

The following graph shows the contents of template_project root directory after
executing `pytask`

```{mermaid}
flowchart LR
    Root["project root"]

    Src["src/"]
    SrcSub["template_project/"]
    SrcSubDir["analysis/<br/>data/<br/>data_management/<br/>final/<br/>\_\_init\_\_.py<br/>config.py"]
    Tests["tests/"]
    Documents["documents/"]
    DocumentsSource["paper.md<br/>presentation.md<br/>myst.yml<br/>refs.bib"]
    DocumentsOutput["public/<br/>tables/"]
    Bld["bld/"]
    BldSub["data/<br/>figures/<br/>tables/<br/>models/<br/>predictions/<br/>documents/"]
    Paper["paper.pdf"]
    Presentation["presentation.pdf"]

    Root --> Paper
    Root --> Presentation
    Root --> Bld
    Root --> Documents
    Root --> Src
    Root --> Tests

    Bld --> BldSub
    Documents --> DocumentsSource
    Documents --> DocumentsOutput
    Src --> SrcSub
    SrcSub --> SrcSubDir

    style Root fill:#04A96D,stroke:#333,stroke-width:2px,color:#fff
    style Bld fill:#FBBB06,stroke:#333,stroke-width:2px,color:#000
    style Documents fill:#04A96D,stroke:#333,stroke-width:2px,color:#fff
    style Paper fill:#FBBB06,stroke:#333,stroke-width:2px,color:#000
    style Presentation fill:#FBBB06,stroke:#333,stroke-width:2px,color:#000
    style Src fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style Tests fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style BldSub fill:#FBBB06,stroke:#333,stroke-width:1px,color:#000
    style DocumentsSource fill:#4d7f9c,stroke:#333,stroke-width:1px,color:#fff
    style DocumentsOutput fill:#04A96D,stroke:#333,stroke-width:1px,color:#fff
    style SrcSub fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style SrcSubDir fill:#4d7f9c,stroke:#333,stroke-width:1px,color:#fff
```

Files and directories in the `bld/` directory (yellow) are constructed by pytask; those
in `src/` and `tests/` (blue) are added directly by the researcher. The `documents/`
directory (green) contains source files for papers and presentations. You immediately
see the **separation of inputs** and outputs (one of our guiding principles) at work:

- All source code is in the src directory
- All outputs are constructed in the bld directory.
- The exception are figures and tables for the paper and presentation. Tools expect
  these to be close (and the "public" directory is a fixed name for slidev).

```{note}

The paper and presentation are copied from `bld/documents` to the root
directory so they can be opened easily

```

The contents of the root/src/template_project directory follow the steps of the analysis
workflow, with subdirectories for data management, analysis, and final output
generation.

All outputs from these steps are placed in the root/bld directory, organized by type:

- Data processing outputs go to root/bld/data
- Model outputs go to root/bld/models and root/bld/predictions
- Final figures go to root/bld/figures
- Final tables go to root/bld/tables
- Compiled documents go to root/bld/documents

## Documents directory structure

The `documents/` directory contains the source files for papers and presentations:

- **`paper.md`**: The main paper written in [MyST Markdown](https://mystmd.org/), which
  is compiled to PDF using
  [Jupyter Book 2.0](https://jupyterbook.org/stable/get-started/init/)
- **`presentation.md`**: The presentation written in [Slidev](https://sli.dev/) Markdown
  format
- **`myst.yml`**: Configuration file for Jupyter Book 2.0, defining project metadata,
  bibliography, and PDF export settings
- **`refs.bib`**: Bibliography file in BibTeX format
- **`public/`**: Directory containing figure files (PNG format) that are generated by
  tasks in `src/template_project/final/task_final_template.py`. Figures are placed here
  so they can be referenced in both the paper and presentation.
- **`tables/`**: Directory containing table files (Markdown format) that are generated
  by tasks in `src/template_project/final/task_final_template.py`. Tables are written in
  Markdown format for inclusion in MyST documents.

The tasks in `src/template_project/final/task_final_template.py` generate:

- Figures in `documents/public/` (e.g., `smoking_by_marital_status.png`)
- Tables in `documents/tables/` (e.g., `estimation_results.md`)

These generated files are then included in the paper and presentation using MyST
Markdown directives (e.g., `{figure}` and `{include}`).

## Zooming in

Lets go one step deeper and consider the root/src directory in more detail:

```{mermaid}
flowchart LR
    Root["src/template_project/"]

    Analysis["analysis/"]
    Data["data/"]
    DataMgmt["data_management/"]
    Final["final/"]
    Config["\_\_init\_\_.py<br/>config.py"]

    AnalysisFiles["\_\_init\_\_.py<br/>model_template.py<br/>predict_template.py<br/>task_analysis_template.py"]
    DataFiles["stats4schools_smoking_template.csv"]
    DataMgmtFiles["\_\_init\_\_.py<br/>stats4schools_smoking_template.py<br/>task_data_management_template.py"]
    FinalFiles["\_\_init\_\_.py<br/>plot_template.py<br/>task_final_template.py"]

    Root --> Analysis
    Root --> Data
    Root --> DataMgmt
    Root --> Final
    Root --> Config

    Analysis --> AnalysisFiles
    Data --> DataFiles
    DataMgmt --> DataMgmtFiles
    Final --> FinalFiles

    style Root fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style Analysis fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style Data fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style DataMgmt fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style Final fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style Config fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style AnalysisFiles fill:#4d7f9c,stroke:#333,stroke-width:1px,color:#fff
    style DataFiles fill:#4d7f9c,stroke:#333,stroke-width:1px,color:#fff
    style DataMgmtFiles fill:#4d7f9c,stroke:#333,stroke-width:1px,color:#fff
    style FinalFiles fill:#4d7f9c,stroke:#333,stroke-width:1px,color:#fff
```

It is imperative that you do all the task handling inside the `task_xxx.py`-scripts,
using the [pathlib](https://realpython.com/python-pathlib/) library. This ensures that
your project can be used on different machines and it minimises the potential for
cross-platform errors.

For running Python source code from pytask, simply include `pathlib.Path`s to the
dependencies and similar path(s) for the special keyword `produces` as the default
arguments to your function.

For running scripts in other languages, pass all required files (inputs, log files,
outputs) as arguments to the `@pytask.mark.[x]`-decorator. You can then read them in.
Check the sections on different programming languages for examples.
