## Directory Structure

### The big picture

The following graph shows the contents of template_project root directory after
executing `pytask`

```{mermaid}
flowchart TD
    Root["project root<br/>(gray: project structure)"]

    Bld["bld<br/>(yellow: build outputs)"]
    Documents["documents<br/>(green: documents / figures / tables)"]
    Paper["paper.pdf<br/>(yellow: build outputs)"]
    Presentation["presentation.pdf<br/>(yellow: build outputs)"]
    Src["src<br/>(blue: source code)"]
    Tests["tests<br/>(blue: source code)"]

    BldSub["data<br/>figures<br/>tables<br/>models<br/>predictions<br/>documents"]
    SrcSub["template_project<br/>(blue: source code)"]

    SrcSubDir["analysis<br/>data<br/>data_management<br/>final<br/>config.py"]

    Root --> Bld
    Root --> Paper
    Root --> Presentation
    Root --> Src
    Root --> Tests

    Bld --> BldSub
    Src --> SrcSub
    SrcSub --> SrcSubDir

    style Root fill:#8A9384,stroke:#333,stroke-width:2px,color:#fff
    style Bld fill:#FBBB06,stroke:#333,stroke-width:2px,color:#000
    style Paper fill:#FBBB06,stroke:#333,stroke-width:2px,color:#000
    style Presentation fill:#FBBB06,stroke:#333,stroke-width:2px,color:#000
    style Src fill:#04539C,stroke:#333,stroke-width:2px,color:#fff
    style Tests fill:#04539C,stroke:#333,stroke-width:2px,color:#fff
    style BldSub fill:#FBBB06,stroke:#333,stroke-width:1px,color:#000
    style SrcSub fill:#04539C,stroke:#333,stroke-width:2px,color:#fff
    style SrcSubDir fill:#4d7f9c,stroke:#333,stroke-width:1px,color:#fff
```

Files and directories in yellow are constructed by pytask; those with a bluish
background are added directly by the researcher. You immediately see the **separation of
inputs** and outputs (one of our guiding principles) at work:

- All source code is in the src directory
- All outputs are constructed in the bld directory

```{note} The paper and presentation are copied to the root so they can be opened easily

```

The contents of both the root/bld and the root/src directories directly follow the steps
of the analysis from the workflow section.

The idea is that everything that needs to be run during the, say, **analysis** step, is
specified in root/src/analysis and all its output is placed in root/bld/analysis.

Some differences:

- Because they are accessed frequently, figures and the like get extra directories in
  root/bld

- The directory root/src contains many more subdirectories and files:

### Documents directory structure

The `documents/` directory contains the source files for papers and presentations:

- **`paper.md`**: The main paper written in [MyST Markdown](https://mystmd.org/), which
  is compiled to PDF using
  [Jupyter Book 2.0](https://jupyterbook.org/stable/get-started/init/)
- **`presentation.md`**: The presentation written in [Slidev](https://sli.dev/) Markdown
  format
- **`myst.yml`**: Configuration file for Jupyter Book 2.0, defining project metadata,
  bibliography, and PDF export settings
- **`refs.bib`**: Bibliography file in BibTeX format
- **`public/`**: Directory containing figure files (PNG format) that are generated by
  tasks in `src/template_project/final/task_final_template.py`. Figures are placed here
  so they can be referenced in both the paper and presentation.
- **`tables/`**: Directory containing table files (Markdown format) that are generated
  by tasks in `src/template_project/final/task_final_template.py`. Tables are written in
  Markdown format for inclusion in MyST documents.

The tasks in `src/template_project/final/task_final_template.py` generate:

- Figures in `documents/public/` (e.g., `smoking_by_marital_status.png`)
- Tables in `documents/tables/` (e.g., `estimation_results.md`)

These generated files are then included in the paper and presentation using MyST
Markdown directives (e.g., `{figure}` and `{include}`).

### Zooming in

Lets go one step deeper and consider the root/src directory in more detail:

```{mermaid}
flowchart TD
    Root["src/template_project<br/>(gray: source code)"]

    Analysis["analysis<br/>(blue: source code)"]
    Data["data<br/>(blue: source code)"]
    DataMgmt["data_management<br/>(blue: source code)"]
    Final["final<br/>(blue: source code)"]
    Config["config.py<br/>(blue: source code)"]

    AnalysisFiles["__init__.py<br/>model.py<br/>predict.py"]
    DataMgmtFiles["__init__.py<br/>clean_data.py"]
    FinalFiles["__init__.py<br/>plot.py"]

    Root --> Analysis
    Root --> Data
    Root --> DataMgmt
    Root --> Final
    Root --> Config

    Analysis --> AnalysisFiles
    DataMgmt --> DataMgmtFiles
    Final --> FinalFiles

    style Root fill:#8A9384,stroke:#333,stroke-width:2px,color:#fff
    style Analysis fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style Data fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style DataMgmt fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style Final fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style Config fill:#4d7f9c,stroke:#333,stroke-width:2px,color:#fff
    style AnalysisFiles fill:#4d7f9c,stroke:#333,stroke-width:1px,color:#fff
    style DataMgmtFiles fill:#4d7f9c,stroke:#333,stroke-width:1px,color:#fff
    style FinalFiles fill:#4d7f9c,stroke:#333,stroke-width:1px,color:#fff
```

It is imperative that you do all the task handling inside the `task_xxx.py`-scripts,
using the [pathlib](https://realpython.com/python-pathlib/) library. This ensures that
your project can be used on different machines and it minimises the potential for
cross-platform errors.

For running Python source code from pytask, simply include `depends_on` and `produces`
as inputs to your function.

For running scripts in other languages, pass all required files (inputs, log files,
outputs) as arguments to the `@pytask.mark.[x]`-decorator. You can then read them in.
Check the sections on different programming languages for examples.
